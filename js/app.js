$(function(){function e(){var e=this,t=new gMaps(mapOptions,mapStyle),r=t.map,a=(t.infoWindow,t.getCurrentLocation()),s=t.marker_animation;e.nearByPlaces=ko.observableArray([]),e.showResults=ko.observable(!0),e.placeReviews=ko.observableArray([]),e.placePhotos=ko.observableArray([]),e.placeInFocus=ko.observable(),e.nytarticles=ko.observableArray([]),e.nytInFocus=ko.observable(),e.foursquarePlaces=ko.observableArray([]),t.self=e;var i="http://api.nytimes.com/svc/search/v2/articlesearch.json?",n="befcd9ed183aa5edba4a379ed537e27f:10:73683129";e.getAddress=function(e){if(e.vicinity){var t=e.vicinity.indexOf(",");return e.vicinity.slice(0,t)}return e.formatted_address},e.getCity=function(e){var t=e.formatted_address.split(" ");return t.slice(-2)},e.toggleResults=function(){1==e.showResults()?e.showResults(!1):e.showResults(!0)},e.icons=ko.computed(function(){var t=new Set,r=[];return e.nearByPlaces().forEach(function(e,r){r&&t.add(e.icon)}),t.forEach(function(e){r.push({icon:e})}),r.slice(0,20)}),e.rateStar=function(e){for(var t=Math.round(e),r=e-t,a=[],s=r>0?4-t:5-t,i=0;t>i;i++)a.push({star:"images/full-star.png"});for(r>0&&a.push({star:"images/half-star.png"}),i=0;s>i;i++)a.push({star:"images/empty-star.png"});return a},e.formattedType=function(e){var t=e.types[0].replace(/[_-]/g," ");return t.charAt(0).toUpperCase()+t.substr(1,t.length)},t.nearbySearch(a),t.initAutocomplete(),e.getWebsite=function(e){return e.website?e.website:""},e.clickMarker=function(e){var r=e.name.toLowerCase();t.markers.forEach(function(e){e.title.toLowerCase()===r&&google.maps.event.trigger(e,"click")})},e.getNytArticle=function(t){var r=e.getCity(t),a=i,s=r[1],o=r[0],c=[],l=$('script[data-template="nytimes"]').html();e.nytInFocus("about "+o+" "+s);var u=setTimeout(function(){c.push("<p>failed to query New York times resources</p>")}.bind(c),5e3);$.getJSON(a,{q:s,fq:o,page:0,sort:"newest",hl:!0,"api-key":n}).done(function(t){"OK"==t.status&&$.each(t.response.docs,function(e,t){var r=t.headline.main;null!=r&&c.push(l.replace(/{{headline}}/,r).replace(/{{articleUrl}}/,t.web_url))}.bind(e)),this.nytarticles(c),clearTimeout(u)}.bind(e)).fail(function(e){c.push("<p>New York Times Articles could bot be loaded</p>"),this.nytarticles(c)}.bind(e))},$("#filters").on("click","button",function(){function e(e){return-1!=e.toLowerCase().indexOf(a.substring(0,4))?e:void 0}s=google.maps.Animation.DROP;var a=$(this).children("img").attr("src").split("/").slice(-1)[0].split("-").slice(0,1)[0];myCategories=mapPlaceTypes.filter(e),t.nearbySearch(r.getCenter())}),$("#reset").on("click",function(){myCategories=[],t.nearbySearch(r.getCenter())})}ko.applyBindings(new e),$("#hide").click(function(){var e="",t=$(this).children("span").attr("class");e="left"===t.slice(29)?t.replace("left","right"):t.replace("right","left"),$(this).siblings("div").animate({width:"toggle"},500),$(this).children("span").attr("class",e)})});
$(function(){function e(){var e=this,t=new gMaps(mapOptions,mapStyle),r=t.map,s=(t.infoWindow,t.getCurrentLocation()),a=t.marker_animation;e.nearByPlaces=ko.observableArray([]),e.showResults=ko.observable(!0),e.placeReviews=ko.observableArray([]),e.placePhotos=ko.observableArray([]),e.placeInFocus=ko.observable(),e.nytarticles=ko.observableArray([]),e.foursquarePlaces=ko.observableArray([]),t.self=e;var n="http://api.nytimes.com/svc/search/v2/articlesearch.json?",o="befcd9ed183aa5edba4a379ed537e27f:10:73683129";e.getAddress=function(e){if(e.vicinity){var t=e.vicinity.indexOf(",");return e.vicinity.slice(0,t)}return e.formatted_address},e.toggleResults=function(){1==e.showResults()?e.showResults(!1):e.showResults(!0)},e.icons=ko.computed(function(){var t=new Set,r=[];for(var s in e.nearByPlaces())s&&t.add(e.nearByPlaces()[s].icon);return t.forEach(function(e){r.push({icon:e})}),r.slice(0,20)}),e.rateStar=function(e){for(var t=Math.round(e),r=e-t,s=[],a=r>0?4-t:5-t,n=0;t>n;n++)s.push({star:"images/full-star.png"});for(r>0&&s.push({star:"images/half-star.png"}),n=0;a>n;n++)s.push({star:"images/empty-star.png"});return s},e.formattedType=function(e){var t=e.types[0].replace(/[_-]/g," ");return t.charAt(0).toUpperCase()+t.substr(1,t.length)},t.nearbySearch(s),t.initAutocomplete(),e.getWebsite=function(e){return e.website?e.website:""},e.clickMarker=function(e){var r=e.name.toLowerCase();t.markers.forEach(function(e){e.title.toLowerCase()===r&&google.maps.event.trigger(e,"click")})},e.getNytArticle=function(t){console.log(t);var r=n,s=t.formated_address,a="",i=setTimeout(function(){console.log("failed to query New York times resources")},5e3);$.getJSON(r,{q:s,fq:a,page:0,sort:"newest",hl:!0,"api-key":o}).done(function(t){e.nytarticles([]),"OK"==t.status&&($.each(t.response.docs,function(t,r){var s=r.headline.main;null!=s&&e.nytarticles().push(s)}),console.log(e.nytarticles())),clearTimeout(i)}).fail(function(e){console.log("New York Times Articles could bot be loaded")})},$("#filters").on("click","button",function(){function e(e){return-1!=e.toLowerCase().indexOf(s.substring(0,4))?e:void 0}a=google.maps.Animation.DROP;var s=$(this).children("img").attr("src").split("/").slice(-1)[0].split("-").slice(0,1)[0];myCategories=mapPlaceTypes.filter(e),t.nearbySearch(r.getCenter())}),$("#reset").on("click",function(){myCategories=[],t.nearbySearch(r.getCenter())})}ko.applyBindings(new e),$("#hide").click(function(){var e="",t=$(this).children("span").attr("class");e="left"===t.slice(29)?t.replace("left","right"):t.replace("right","left"),$(this).siblings("div").animate({width:"toggle"},500),$(this).children("span").attr("class",e)})});